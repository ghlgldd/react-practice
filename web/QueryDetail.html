<!DOCTYPE HTML>
<html>
<head>
	<title></title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE10">
	<link rel="stylesheet" type="text/css" href="css/kendo.common.min.css">
	<link rel="stylesheet" type="text/css" href="css/kendo.default.min.css">
	<link rel="stylesheet" type="text/css" href="css/manageSys.css">
	<script src="lib/kendo/js/jquery.min.js"></script>
	<script src="lib/kendo/js/kendo.custom.min.js"></script>
	<script src="lib/kendo/js/jszip.min.js"></script>
	<script src="js/wp.js"></script>
</head>

<body>
	<div id="user_id" style="display:none"></div>
	<div id="first_name" style="display:none"></div>
	<div id="last_name" style="display:none"></div>
	<div id="sider" style="position:relative;margin:0 auto;margin-top:2%">	
		<div id="sider_content">
			<div id="query_details_title">Query Details</div>
			<div id="empty_details">Loading...</div>
		</div>
	</div>
    <div id="global_alert_win"><p></p><span class="btn no"></span><span class="btn yes"></span></div>
<script id="sider_details" type="text/x-kendo-template">
	<span style="position:relative;float:right;right:25px;color:black;top:6px;font-size:10pt;display:none;cursor:pointer" id="query_detail_spotfire">Launch Spotfire</span>
	<div id="query_details_title" data-bind="text:title"></div>
	<div id="query_status_frame" class="query_status_frame" data-template="response_status_template" data-bind="source: this"></div>
	<div id="query_content_frame">
		<div class="query_content_frame_left">
				<span class="query_span">Study</span>
				<input id="query_study" style="width:15em;"  />
			</div>

			<div class="query_content_frame_right">
				<span class="query_span" style="padding-right:4em;">Site</span>
				<input id="query_site" style="width:15em;height:30px;padding-left:34px;" disabled="disabled" />
			</div>

			<div class="query_content_frame_left">
				<span class="query_span" style="padding-right:3.15em;">Patient ID</span>
				<input id="query_patientid" style="width:15em;"  />
			</div>

			<div class="query_content_frame_right">
				<span class="query_span" style="padding-right:4em;">CRF</span>
				<input id="query_crf" style="width:15em;padding-left:29px;"  />
			</div>

			<div class="query_content_frame_left">
				<span class="query_span" style="padding-right:5.7em;">Visit</span>
				<input id="query_visit" style="width:15em;"  />
			</div>

			<div class="query_content_frame_right">
				<span class="query_span" style="padding-right:4em;">Assign to</span>
				<input id="query_assignto" style="width:15em;"  />
			</div>

			<div class="query_content_frame_text" >
				<span class="query_span" style="top:8px;left:28px;">Issue</span>
				<input id="query_issue" type="text" placeholder="Issue title" disabled="disabled" />
			</div>

			<div class="query_content_frame_text" style="margin-bottom:15px">
				<span class="query_span" style="top:3px;left:26px;">Query Text</span>
				<textarea id="query_detail_text" type="text" placeholder="Enter query details here" disabled="disabled"></textarea>
			</div>

			<div class="query_content_frame_left" >
				<span class="query_span" style="top:8px;padding-right:2.5em;">Opened By</span>
				<input id="query_usename" style="width:15em;height:30px;border-radius:4px;border:solid 1px #c5c5c5;padding-left:0.5em;" data-bind="value:query_username" disabled="disabled" />
			</div>

			<div class="query_content_frame_right">
				<span class="query_span" style="top:8px;padding-right:4.5em;">Open Date</span>
				<input id="query_open_date" style="width:14.5em;height:30px;border-radius:4px;border:solid 1px #c5c5c5;padding-left:0.5em;" disabled="disabled" data-bind="value:open_date"  />
			</div>

			<div class="query_content_frame_left">
				<span class="query_span" style="padding-right:4.7em;">Status</span>
				<input id="query_status" style="width:15em;"  />
			</div>

			<div class="query_content_frame_right" id="site_checkbox" style="opacity:0">
				<span class="query_span" style="top:8px;padding-right:4.5em;">Site Response</span>
				<input id="query_site_response_checkbox" type="checkbox" style="width:13.35em;position:relative;left:-105px;top:8px;display:block;" disabled="disabled" />
			</div>

			<div class="query_content_frame_text" id="site_response_input" >
				<span class="query_span" style="top:6px;left:28px;">Site Response</span>
				<input id="query_site_response" placeholder="Enter Site Response" disabled="disabled" maxlength="3999"/>
			</div>

			<div class="query_content_frame_text" >
				<span class="query_span" style="top:6px;left:28px;">DM/Clinical<br/>Comments</span>
				<textarea id="query_response" type="text" placeholder="Enter your response" disabled="disabled" maxlength="3999"></textarea>
			</div>

			<div class="query_button">
				<button type="button" class="k-button" id="query_update_button" data-bind="click:updata_query_detail" >Update</button>
				<button type="button" class="k-button" id="query_close" data-bind="click:close" style="background-color:#BFBFBF!important" >Cancel</button>
			</div>
			<div style="position:absolute;top:-999px;left:-999px;display:none">
                <input id="create_clickme" style="width:30px;"/>
            </div>
			<div id="response_history_title">
				<div class="response_history_title_left">
					<img src="imgs/manageSys/filter.png" id="response_title_img" />
					<span id="response_history_title_text">Response History</span>
				</div>
			</div>
			<div id="response_history_frame">
				<div id="response_history_grid" data-template="response_history_grid_list" data-bind="source: this">
	            
	        	</div>
			</div>
	</div>
</script>

<script id="response_status_template" type="text/x-kendo-template" >
	<div>
		#if(data.length == 0){#
			#$('.query_status_frame').empty();#
		#}else{#
				#function to_localtime(_time){#
				#if(_time.indexOf('AM')>-1){#
					#var time=_time.replace(/AM/,' AM' );#
				#}else{#
					#var time=_time.replace(/PM/,' PM' );#
				#}#
				#var _time_lag = new Date().getTimezoneOffset();#
		    	#_time_lag = _time_lag*60*1000#
		    	#var utc_seconds = new Date(time).getTime()#
		    	#var local_seconds = utc_seconds - _time_lag #
		    	#var local_time_a = kendo.toString(new Date(local_seconds), 'MMM dd , yyyy')#
		    	#return local_time_a#
		    #}#
		<div id="query_status_pic" class="query_status_pic">
			<div id="open_status_gray"></div>
			<div id="clarification_status_gray"></div>
			<div id="close_status_gray"></div>
				#var a="",b="",c="";#
				#var d="",e="",f="";#				
				#for(var i=0;i<data.length;i++){#
					#if(data[i].StatusType == 1){#
						#a=data[i].TimeStamp; d=data[i].StatusName #
						#a=to_localtime(a)#
						#if(data[i].State == 'InProgress'){#
							<div id="open_status_amber"></div>
						#}else if(data[i].State == 'Completed'){#
							<div id="open_status_green"></div>
						#}else{#
							<div id="open_status_gray"></div>
						#}#
					#}else if(data[i].StatusType == 2){#
						#b=data[i].TimeStamp;e=data[i].StatusName #
						#b=to_localtime(b)#	
						#if(data[i].State == 'InProgress'){#
							<div id="clarification_status_amber"></div>
						#}else if(data[i].State == 'Completed'){#
							<div id="clarification_status_green"></div>
						#}else{#
							<div id="clarification_status_gray"></div>
						#}#
					#}else if(data[i].StatusType == 3){#
						#c=data[i].TimeStamp;f=data[i].StatusName #
						#c=to_localtime(c)#	
						#if(data[i].State == 'InProgress'){#
							<div id="close_status_amber"></div>
						#}else if(data[i].State == 'Completed'){#
							<div id="close_status_green"></div>
						#}else{#
							<div id="close_status_gray"></div>
						#}#
					#}#
				#}#
		</div>
			<div id="open_text" class="open_text">#:d#</div>
			<div id="clarification_text"  class="clarification_text">#:e#</div>
			<div id="close_text" class="close_text">#:f#</div>
			<div id="open_date">#:a#</div>
			<div id="clarification_date">#:b#</div>
			<div id="close_date">#:c#</div>
			<div id="inti_sta">Initial Status</div>
			<div id="inter_sta">Intermediate Status</div>
			<div id="final_sta">Final Status</div>
		#}#
	</div>
</script>

<script id="response_history_grid_list" type="text/x-kendo-template">
	<div>
		<table id="response_grid" style="text-align:center;overflow-x:hidden">
            	<colgroup>
                	<col />
                    <col />
                    <col />
                    <col />
                    <col />
                    <col />
                </colgroup>
	            <thead id="table_head">
                    <tr>
                        <th data-field="Timestamp" style="text-align:center">Timestamp</th>
                        <th data-field="Patient" style="text-align:center" id="b">Response From</th>
                        <th data-field="Study" style="text-align:center">Responded By</th>
                        <th data-field="Site" style="text-align:center">DM/Clinical Comments</th>
                        <th data-field="CRF" style="text-align:center">Site Response</th>
                        <th data-field="Issue" style="text-align:center">Status</th>
                    </tr>
	            </thead>
                <tbody>
                	# for(var i=0, l = data.length; i < l ;i++){ #
					    <tr>
						    #if(data[i].TimeStamp == null){#
						    	<td>--</td>
						    #}else{#
						    	#var _time_lag = new Date().getTimezoneOffset();#
						    	#_time_lag = _time_lag*60*1000#
						    	#var utc_seconds = new Date(data[i].TimeStamp).getTime()#
						    	#var local_seconds = utc_seconds - _time_lag #
						    	#var local_time = kendo.toString(new Date(local_seconds), 'MMM dd, yyyy HH:mm')#
						    	<td>#:local_time#</td>
						    #}#

						    #if(data[i].ResponseFrom == null){#
						    	<td>--</td>
						    #}else{#
						    	<td>#:data[i].ResponseFrom#</td>
						    #}#
					        
						    #if(data[i].Respondedby == null){#
						    	<td>--</td>
						    #}else{#
						    	<td>#:data[i].Respondedby#</td>
						    #}#

						    #if(data[i].Response == null){#
						    	<td>--</td>
						    #}else{#
						    	<td>#:data[i].Response#</td>
						    #}#

						    #if(data[i].SiteInput == null){#
						    	<td>--</td>
						    #}else{#
						    	<td>#:data[i].SiteInput#</td>
						    #}#

						    #if(data[i].Status == null){#
						    	<td>--</td>
						    #}else{#
						    	<td>#:data[i].Status#</td>
						    #}#
					    </tr>

					# } #
	    	</tbody>
		</table>
	</div>
</script>
<script id="respinse_input" type="text/x-kendo-template">
	<div>
		<span style="position:relative;top:-80px;">Response Input</span>
		<textarea id="response_input" style="width:83%;height:160px;"></textarea>
		<div class="response_button">
				<button type="button" class="k-button" id="response_cancel_button" data-bind="click:response_cancel" style="background-color:#BFBFBF!important;margin-right:10px;" >Cancel</button>
				<button type="button" class="k-button" id="response_close_button" >Close</button>
		</div>
	</div>	
</script>

<script type="text/javascript">
	var querydetail = (function () {
	    var _select_id = '';
	    var query_select_id = '';
	    var user_id = $('#user_id').text();
	    var user_role = '';
	    function UrlParamHash(url) {
	        var params = "", h;
	        var hash = url.slice(url.indexOf("?") + 1).split('&');
	        for (var i = 0; i < hash.length; i++) {
	            h = hash[i].split("=");
	            if (h[0] == "QueryID") {
	                params = h[1];
	            }
	        }
	        return params;
	    };
		//
		function bind_click() {
			$('.response_history_title_left').click(function () {
				$('#response_history_frame').slideToggle("normal", function () {
					var _img_src = $('#response_title_img').attr('src');
					if (_img_src == 'imgs/manageSys/filter.png1') {
						$('#response_title_img').attr('src', 'imgs/manageSys/filter.png');
					} else {
						$('#response_title_img').attr('src', 'imgs/manageSys/filter1.png');
					}
				});
			});
		};
	    //
		function to_localtime(_time) {
		    var _time_lag = new Date().getTimezoneOffset();
		    _time_lag = _time_lag * 60 * 1000;
		    var utc_seconds = new Date(_time).getTime();
		    var local_seconds = utc_seconds - _time_lag;
		    var local_time_a = kendo.toString(new Date(local_seconds), 'MMM dd, yyyy');
		    return local_time_a
		};

		function sider_content_vm(data) {
			var query_study = $("#query_study").kendoDropDownList({
				enable: false,
				dataSource: [data.StudyName]
			}).data("kendoDropDownList");

			var query_site = $("#query_site").kendoDropDownList({
				enable: false,
				dataSource: [data.SiteName]
			}).data("kendoDropDownList");

			var query_patientid = $("#query_patientid").kendoDropDownList({
				enable: false,
				dataSource: [data.PatientID]
			}).data("kendoDropDownList");

			var query_crf = $("#query_crf").kendoDropDownList({
				enable: false,
				dataSource: [data.CRFName]
			}).data("kendoDropDownList");

			var query_visit = $("#query_visit").kendoDropDownList({
				enable: false,
				dataSource: [data.VisitName]
			}).data("kendoDropDownList");

			var query_assignto = $("#query_assignto").kendoDropDownList({
				enable: false,
				dataSource: [data.AssignTo]
			}).data("kendoDropDownList");

			var _a_actions = data.Actions;
			_a_actions.unshift({ "ActionDisplayName": data.Status, "ActionName": "Update" });

			var query_status = $("#query_status").kendoDropDownList({
			    enable: true,
			    dataSource: _a_actions,
			    dataTextField: "ActionDisplayName",
			    dataValueField: "ActionName"
			}).data("kendoDropDownList");

			var create_clickme = $("#create_clickme").kendoDropDownList({
                dataSource: ["a"]
            }).data("kendoDropDownList");

			var query_site = $("#query_site").data("kendoDropDownList");
			var query_status = $("#query_status").data("kendoDropDownList");
			if (data.Issue != "") {
			    $('#query_issue').val(data.Issue);
			};
			if (data.QueryText != "") {
			    $('#query_detail_text').val(data.QueryText);
			};
			if (data.ResponseInput != "") {
			    $('#query_response').val(data.ResponseInput);
			};			
			if (data.IsEditable == true && data.Status == 'Open') {
			    $('.query_button').show();
			    query_status.enable(true);
			    $('#query_issue').removeAttr('disabled');
			    $('#query_detail_text').removeAttr('disabled');
			    $('#query_response').removeAttr('disabled');
			    $('#query_site_response').removeAttr('disabled');
			    $('#query_site_response_checkbox').removeAttr('disabled');
			    $('#query_response').focus();
			} else if (data.IsEditable == true && data.Status != 'Open') {
			    $('.query_button').show();
			    query_status.enable(true);
			    $('#query_response').removeAttr('disabled');
			    $('#query_site_response').removeAttr('disabled');
			    $('#query_site_response_checkbox').removeAttr('disabled');
			    $('#query_response').focus();
			}
            else if (data.Status != 'closed' && user_role == 'CS') {
            		$('#query_response').removeAttr('disabled');
            		$('.query_button').show();
        	}
			else {
			    $('.query_button').hide();
			    query_status.enable(false);
			    $('#query_issue').attr('disabled', 'disabled');
			    $('#query_detail_text').attr('disabled', 'disabled');
			    $('#query_response').attr('disabled', 'disabled');
			    $('#query_site_response').attr('disabled', 'disabled');
			    $('#query_site_response_checkbox').attr('disabled', 'disabled');
			}
			if (user_role == 'DM' || user_role == 'CRA' || data.IsEditable == false) {                         
                         $('#query_issue').attr("disabled", "disabled");
                         $('#query_detail_text').attr("disabled", "disabled");
                     	}
                     	else {
                         $('#query_issue').attr("disabled", "disabled");
                         $('#query_detail_text').attr("disabled", "disabled");
                         if (data.Status == 'Open') {
                             $('#query_issue').removeAttr('disabled');
                             $('#query_detail_text').removeAttr('disabled');
                             $('#query_issue').focus();
                         }
                     	}
			var _open_date = data.OpenDate;
			_open_date = to_localtime(_open_date);

			var vm = kendo.observable({
				open_date: function () {
				    return _open_date
				},
				open_user: function () {
					return data.Openedby;
				},
				close: function () {
				    window.close();
				},
				title: function () {
					return 'Query Details of ' + data.QueryID
				},
				query_username: function () {
				    return data.Openedby
				},
				updata_query_detail: function () {
					$('body').append('<div id="query_detail_laoding" style="position: absolute;top: 0px;z-index: 999;width: 100%;height: 100%;background-color:rgba(0,0,0,0);cursor:wait"></div>');
				    var actions = [];
				    var _issue_val = $('#query_issue').val();
				    var _q_detail_val = $('#query_detail_text').val();
				    var _q_response = $('#query_response').val();
				    var query_status = $("#query_status").data("kendoDropDownList");
				    if(_q_response == "" && query_status == 'Closed') {
                    $('#query_detail_laoding').remove();
                     manageSys.utils.alertMsg("Confirmation alert", "Please fill your Comments.", function () {$('body').css('cursor', 'default');});
                 return
                }
				    for (var i = 0; i < data.Actions.length; i++) {
				        actions.push(data.Actions[i]);
				    }
				    var status_val = query_status.value();
				    var _siteresponse = data.SiteResonse;
				    var _siteinput = data.SiteInput;
				    if (user_role == 'DM' || user_role == 'CRA') {
				        var _status = $('#query_site_response_checkbox')[0].checked;
				        if (_status == true) {
				            _siteresponse = "true";
				        } else {
				            _siteresponse = "false";
				        }
				        _siteinput = $('#query_site_response').val();
				    }
				    var update_list = { "QueryID": data.QueryID, "StudyId": data.StudyId, "StudyName": data.StudyName, "SiteId": data.SiteId, "SiteName": data.SiteName, "PatientID": data.PatientID, "Issue": _issue_val, "CRFId": data.CRFId, "CRFName": data.CRFName, "VisitId": data.VisitId, "VisitName": data.VisitName, "QueryText": _q_detail_val, "AssignTo": data.AssignTo, "Openedby": data.Openedby, "OpenedbyId": data.OpenedById, "OpenDate": data.OpenDate, "Status": data.Status, "SiteResonse": _siteresponse, "SiteInput": _siteinput, "ResponseInput": _q_response, "Action": status_val }
				    var update_query_datasource = new kendo.data.DataSource({
				        transport: {
				            read: {
				                dataType: "json",
				                contentType: 'application/json',
				                url: QMT_RESTFUL_URL + "QMT/PostUpdateQueryDetails",
				                type: "POST"
				            },
				            parameterMap: function () {
				                return JSON.stringify(update_list);
				            }
				        },
				        schema: {
				            data: function (response) {
				                if (response.ResponseCode == "WP1022") {
				                    var _message = "Clinical Query "+data.QueryID+" updated successfully"
									manageSys.utils.alertMsg("Confirmation alert",_message, function () { });
				                    $('#query_site_response').val("");
	                   				$('#query_response').val("");
				                    var datasouceGetQueryHistory = new kendo.data.DataSource({
				                        transport: {
				                            read: {
				                                dataType: "json",
				                                url: QMT_RESTFUL_URL + "QMT/" + query_select_id + "/GetQueryHistoryById"
				                            },
				                        },
				                        schema: {
				                            data: "HistoryDetailsList"
				                        },
				                        error: function (response) {
				                            if (response.StatusGraphNodeDetailsList == null) {
				                                return []
				                            }
				                            $('#query_update_button').removeAttr("disabled");
				                        }
				                    });
				                    datasouceGetQueryHistory.read().then(function () {
				                        var data_history = datasouceGetQueryHistory.data();
				                        var viewModel_history = drivelist(data_history);
				                        kendo.bind($('#response_history_grid'), viewModel_history);
				                        bind_click();
				                        $("#response_grid").kendoGrid({
				                            scrollable: false
				                        }).data("kendoGrid");
				                    });
				                } else {
				                    manageSys.utils.alertMsg("Confirmation alert", response.ResponseMessage, function () { });
				                    $('#query_update_button').removeAttr("disabled");
				                }
				                $('#query_detail_laoding').remove();
				                return [];
				            }
				        },
				        error: function (response) {
				        	$('#query_detail_laoding').remove();
				           // console.log(response);
				        }
				    });
				    update_query_datasource.read();
				    $('#query_update_button').attr("disabled", "disabled");
				}
			});
            return vm;
        };

		function drivelist(listdata) {
			var vm = kendo.observable({
				data: listdata
			});
			return vm;
		};

		function response_status(data) {
			var vm = kendo.observable({
				data: data,
				clarification_date: function () {
					return new Date()
				},
				open_date: function () {
					return new Date()
				},
				close_date: function () {
					return new Date()
				}
			});
			return vm;
		};

		return {
		    init: function () {
		        $.ajaxSetup({
		            beforeSend: function (xhr) {
		                xhr.setRequestHeader("UserId", user_id);
		            }
		        });
		        querydetail.getUserName(function () {
		            var _url = window.location.search;
		            var _select_id = UrlParamHash(_url);
		            query_select_id = _select_id;
		            var datasouceGetQueryDetails = new kendo.data.DataSource({
		                transport: {
		                    read: {
		                        dataType: "json",
		                        url: QMT_RESTFUL_URL + "QMT/" + _select_id + "/GetQueryDetailsById",
		                    },
		                },
		                schema: {
		                    data: function (response) {
		                        return [response];
		                    }
		                },
		                errors: function (response) {
		                    if (response.StatusGraphNodeDetailsList == null) {
		                        return []
		                    }
		                }
		            });

		            var datasouceGetQueryHistory = new kendo.data.DataSource({
		                transport: {
		                    read: {
		                        dataType: "json",
		                        url: QMT_RESTFUL_URL + "QMT/" + _select_id + "/GetQueryHistoryById",
		                    },
		                },
		                schema: {
		                    data: "HistoryDetailsList"
		                },
		                errors: function (response) {
		                    if (response.StatusGraphNodeDetailsList == null) {
		                        return []
		                    }
		                }
		            });

		            var datasoucestatus = new kendo.data.DataSource({
		                transport: {
		                    read: {
		                        dataType: "json",
		                        url: QMT_RESTFUL_URL + "QMT/" + _select_id + "/GetStatusGraphDetails",
		                    },
		                },
		                schema: {
		                    data: "StatusGraphNodeDetailsList",
		                    errors: function (response) {
		                        if (response.StatusGraphNodeDetailsList == null) {
		                            return []
		                        }
		                    }
		                }
		            });

		            datasouceGetQueryDetails.read().then(function () {
		                datasouceGetQueryHistory.read().then(function () {
		                    datasoucestatus.read().then(function () {
		                        var data_details = datasouceGetQueryDetails.data()[0];
		                        var data_history = datasouceGetQueryHistory.data();
		                        var data_status = datasoucestatus.data();
		                        $('#sider_content').html($('#sider_details').html());
		                        var viewModel_content = sider_content_vm(data_details);
		                        kendo.bind($('#sider_content'), viewModel_content);
		                        var viewModel_history = drivelist(data_history);
		                        kendo.bind($('#response_history_grid'), viewModel_history);
		                        var viewModel_status = response_status(data_status);
		                        kendo.bind($('#query_status_frame'), viewModel_status);
		                        /*if (user_role == "CS" || user_role == "MM") {
		                            $('#query_detail_spotfire').css('display', 'none');
		                        } else {
		                            $('#query_detail_spotfire').css('display', 'none');
		                        }*/
		                        $('#create_clickme').trigger('click');
                                $('#create_clickme-list').css('display','none');
		                        if (user_role == "DM" || user_role == "CRA") {
		                            $('#site_checkbox').css('opacity', '1')
		                        }else{
		                        	$('#site_checkbox').css('opacity','0');
									$('#query_site_response_checkbox').attr('disabled','disabled');
		                        }
		                        $("#response_grid").kendoGrid({
		                            scrollable: false
		                        }).data("kendoGrid");
		                        bind_click();
		                        $('#query_site_response_checkbox').click(function () {
		                            if (this.checked == true) {
		                                $('#site_response_input').show();
		                            } else {
		                                $('#site_response_input').hide();
		                            }
		                        });
		                        var height = $(window).height();
		                        var query_detail_height = Math.floor(height * 0.9);
		                        var quert_detail_content_height = Math.floor(query_detail_height - 150);
		                        $('#sider').css('height', query_detail_height);
		                        $('#sider_content').css('height', query_detail_height);
		                        $('#query_content_frame').css('height', quert_detail_content_height);
		                    });
		                });
		            });
		        });
		    },
		    getUserName: function (callback) {
		        var _datasource_username = new kendo.data.DataSource({
		            transport: {
		                read: {
		                    dataType: "json",
		                    url: QMT_RESTFUL_URL + "QMT/GetUserDetailsbyId",
		                }
		            },
		            schema: {
		                data: function (response) {
		                    return [response]
		                }
		            }
		        });

		        _datasource_username.read().then(function () {
		            if (_datasource_username.data()[0].ResponseCode != 'WP2026') {
		                login_username = _datasource_username.data()[0].FirstName;
		                user_role = _datasource_username.data()[0].UserRole;
		                callback();
		            }
		            else {
		                window.location = '<%= System.Configuration.ConfigurationManager.AppSettings["QMTredirectUrl"].ToString() %>';
                }
				});
			},
		}
	})();

$(document).ready(function () {
    $(function () {
        querydetail.init();
    });
})
</script>
<!-- js_end -->

</body>
</html>